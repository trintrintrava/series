<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"

        logicalFilePath="db\changelog\Task4\create-table.xml"

        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="
            http://www.liquibase.org/xml/ns/dbchangelog
            http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd
        ">

        <!-- Create actor table -->
        <changeSet id="create-actor-table" author="trintrintrava">
    <!--        id уникален в пределах changeset-->

            <preConditions onFail="MARK_RAN">
                <not>
                    <tableExists tableName="actor" schemaName="el_j"/>
                </not>
            </preConditions>

            <createTable tableName="actor">
                <column autoIncrement = "true" name="id" type="BIGINT">
                    <constraints
                            primaryKey="true"
                            primaryKeyName="actor_pk"/>
                </column>
                <column name="name" type="VARCHAR(255)">
                    <constraints nullable="false"/>
                </column>
                <column name="second_name" type="VARCHAR(255)">
                    <constraints nullable="false"/>
                </column>
            </createTable>
        </changeSet>

    <!-- Create film table -->
    <changeSet id="create-film-table" author="trintrintrava">

        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="film" schemaName="el_j"/>
            </not>
        </preConditions>

        <!--        id уникален в пределах changeset-->
        <createTable tableName="film">
            <column autoIncrement = "true" name="id" type="BIGINT">
                <constraints
                        primaryKey="true"
                        primaryKeyName="film_pk"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="director" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="create-actor-to-film-table" author="trintrintrava">

        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="act_to_film" schemaName="el_j"/>
            </not>
        </preConditions>

        <!--        id уникален в пределах changeset-->
        <createTable tableName="act_to_film">
            <column autoIncrement = "true" name="id" type="BIGINT">
                <constraints
                        primaryKey="true"
                        primaryKeyName="act_to_film_pk"/>
            </column>
            <column name="actor_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="film_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet  id="fk_atf_actor" author="trintrintrava" >
        <addForeignKeyConstraint  baseColumnNames="actor_id"
                                  baseTableName="act_to_film"
                                  baseTableSchemaName="el_j"
                                  constraintName="fk_atf_actor"
                                  referencedColumnNames="id"
                                  referencedTableName="actor"
                                  referencedTableSchemaName="el_j"/>
    </changeSet>

    <changeSet  id="fk_atf_film" author="trintrintrava" >
        <addForeignKeyConstraint  baseColumnNames="film_id"
                                  baseTableName="act_to_film"
                                  baseTableSchemaName="el_j"
                                  constraintName="fk_atf_film"
                                  referencedColumnNames="id"
                                  referencedTableName="film"
                                  referencedTableSchemaName="el_j"/>
    </changeSet>

    <changeSet author="trintrintrava" id="addColumn-to-Film">
        <preConditions onFail="MARK_RAN">
            <not>
               <or>
                <columnExists tableName="film" columnName="rating" schemaName="el_j"/>
                <columnExists tableName="actor" columnName="gender" schemaName="el_j"/>
               </or>
            </not>
        </preConditions>

        <addColumn schemaName= "el_j"
                   tableName="film" >
            <column name="rating"
                    type="BIGINT"/>
        </addColumn>

        <addColumn schemaName= "el_j"
                   tableName="actor" >
            <column name="gender"
                    type="VARCHAR(255)"/>
        </addColumn>

    </changeSet>

    <changeSet id="add-birth-column-to-actor" author="trintrintrava">
        <preConditions onFail="MARK_RAN">
                <not>
                    <columnExists schemaName="el_j" tableName="actor" columnName="birth"/>
                </not>
        </preConditions>

        <addColumn tableName="actor"
                    schemaName="el_j">
            <column name="birth" type="DATE"/>
        </addColumn>

    </changeSet>
    
    <changeSet id="add-user-table" author="trintrintrava">
        <preConditions>
            <not>
                <tableExists tableName="users" schemaName="el_j"/>
            </not>
        </preConditions>

        <createTable tableName="users">
            <column autoIncrement = "true" name="id" type="BIGINT">
                <constraints
                        primaryKey="true"
                        primaryKeyName="users_pk"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="gender" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="birth" type="DATE">
                <constraints nullable="false"/>
            </column>
        </createTable>
        
    </changeSet>
    
    <changeSet id="add-review-table" author="trintrintrava">
        <preConditions>
            <not>
                <tableExists tableName="review" schemaName="el_j"/>
            </not>
        </preConditions>

        <createTable tableName="review" schemaName="el_j">
            <column autoIncrement = "true" name="id" type="BIGINT">
                <constraints
                        primaryKey="true"
                        primaryKeyName="review_pk"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="film_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="rating" type="DECIMAL(4,1)">
                <constraints nullable="false"/>
            </column>
            <column name="review_text" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>

    <changeSet  id="fk_review_users" author="trintrintrava" >
        <addForeignKeyConstraint  baseColumnNames="user_id"
                                  baseTableName="review"
                                  baseTableSchemaName="el_j"
                                  constraintName="fk_review_users"
                                  referencedColumnNames="id"
                                  referencedTableName="users"
                                  referencedTableSchemaName="el_j"/>
    </changeSet>

    <changeSet  id="fk_review_film" author="trintrintrava" >
        <addForeignKeyConstraint  baseColumnNames="film_id"
                                  baseTableName="review"
                                  baseTableSchemaName="el_j"
                                  constraintName="fk_review_film"
                                  referencedColumnNames="id"
                                  referencedTableName="film"
                                  referencedTableSchemaName="el_j"/>
    </changeSet>

</databaseChangeLog>